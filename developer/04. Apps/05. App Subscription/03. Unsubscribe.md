## Unsubscribe

Enable customers of an app to unsubscribe the active subscription.
With the unsubscription connected objects (see details below) are getting inactivated as well.

[Functional Description](/docs/04.%20App(s)/05.%20App%20Subscription/05.%20App%20Unsubscribe.md)

<br>

### Implementation 

#### #1 GET Subscribed Apps

Retrieves all app subscriptions of the user acting company.
<br>

##### Business Logic:  

* only responsed with active subscriptions

<br>

##### Validation:

* app id must be existing (no matter in which status)
* subscriptionId must be existing and assigned 

<br>

```diff
! GET: /api/apps/subscribed/activesubscriptions
```

<br>

Response Body

    {
      "offerId": "uuid",
      "name": "string - app name",
      "provider": "string - company name",
      "image": "uuid",
      "subscriptionId": "uuid"
    }

<br>
<br>

#### #2 GET Subscription Details

Fetches the app subscriptions details incl. possible linked tech user and connector id.
<br>

##### Business Logic:  

* based on the subscriptionId check linked technical user and connectors and include the same in the response body
  * based on the subscriptionId look-up the possible linked connector ID via table portal.connector_assigned_offer_subscriptions. If an connector ID is found, get via the connector ID and table portal.connectors all related connector data
  * 

<br>

##### Validation:

* app id must be existing (no matter in which status)
* subscriptionId must be existing and assigned 

<br>

```diff
! GET /api/Apps/{appId}/subscription/{subscriptionId}/subscriber
```

<br>

Response Body

    {
      "id": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
      "offerSubscriptionStatus": "PENDING",
      "name": "string",
      "provider": "string",
      "contact": [
        "string"
      ],
      "technicalUserData": [
        {
          "id": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
          "name": "string",
          "permissions": [
            "string"
          ]
        }
      ],
      "connectorData": [
        {
          "id": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
          "name": "string",
          "endpoint": "string"
        }
      ]
    }

<br>
<br>


#### #3 PUT Unsubscribe

The subsciption customer (offer_subscriptions.company_id) is able to unsubscribe from an app.
<br>

##### Business Logic:  
With the PUT api, the backend service will
* set linked "connector" instances to "DELETED"
* set the SD document of the "connector" to "DELETED"
* set linked "technical user" to "DELETED"
* last but not least the subscription record itselfe gets updated to "INACTIVE"

##### Validation:
* user can only unsubscribe subscriptions where the user assigned company is subscription holder/owner
* only subscriptions in status "ACTIVE" can get set to "INACTIV"E - other status subscriptions will result in an error "Subscription in wrong status. Action not possible."

<br>

```diff
! PUT /api/Apps/{subscriptionId}/unsubscribe
```

<br>
<br>
